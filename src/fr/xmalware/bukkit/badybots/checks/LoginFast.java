package fr.xmalware.bukkit.badybots.checks;

import java.util.HashMap;

import org.bukkit.event.player.PlayerCommandPreprocessEvent;
import org.bukkit.event.player.PlayerJoinEvent;
import org.bukkit.event.player.PlayerLoginEvent;
import org.bukkit.event.player.PlayerQuitEvent;

import fr.xmalware.bukkit.badybots.checks.abstracts.Check;
import fr.xmalware.bukkit.badybots.checks.abstracts.CheckResponse;
import fr.xmalware.bukkit.badybots.checks.abstracts.CheckType;

public class LoginFast extends Check {

	private static HashMap<String, Long> logins = new HashMap<>();
	
	public LoginFast() {
		super(CheckType.LOGIN_FAST);
	}

	@Override
	public CheckResponse onLogin(PlayerLoginEvent event) {
		return CheckResponse.ALLOW;
	}

	@Override
	public CheckResponse onJoin(PlayerJoinEvent event) {
		logins.put(event.getPlayer().getName().toLowerCase(), System.currentTimeMillis());
		return CheckResponse.ALLOW;
	}

	@Override
	public CheckResponse onCommandPreprocess(PlayerCommandPreprocessEvent event) {
		CheckResponse checkResponse = CheckResponse.ALLOW;
		String playerName = event.getPlayer().getName().toLowerCase();
		if ((event.getMessage().startsWith("/login") || event.getMessage().startsWith("/l")) && logins.containsKey(playerName)) {
			double difference = System.currentTimeMillis() - logins.get(playerName);
			if (difference <= 2_000L) {
				checkResponse = CheckResponse.BAN;
			}
		}
		return checkResponse;
	}
	
	@Override
	public void onPlayerQuit(PlayerQuitEvent event) {
	}
	
}
