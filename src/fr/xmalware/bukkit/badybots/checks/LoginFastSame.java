package fr.xmalware.bukkit.badybots.checks;

import java.util.HashMap;

import org.bukkit.event.player.PlayerCommandPreprocessEvent;
import org.bukkit.event.player.PlayerJoinEvent;
import org.bukkit.event.player.PlayerLoginEvent;
import org.bukkit.event.player.PlayerQuitEvent;

import fr.xmalware.bukkit.badybots.checks.abstracts.Check;
import fr.xmalware.bukkit.badybots.checks.abstracts.CheckResponse;
import fr.xmalware.bukkit.badybots.checks.abstracts.CheckType;

public class LoginFastSame extends Check {

	private static HashMap<String, Long> passwords = new HashMap<>();

	public LoginFastSame() {
		super(CheckType.LOGIN_FAST_SAME);
	}

	@Override
	public CheckResponse onLogin(PlayerLoginEvent event) {
		return CheckResponse.ALLOW;
	}

	@Override
	public CheckResponse onJoin(PlayerJoinEvent event) {
		return CheckResponse.ALLOW;
	}

	@Override
	public CheckResponse onCommandPreprocess(PlayerCommandPreprocessEvent event) {
		CheckResponse checkResponse = CheckResponse.ALLOW;
		if (event.getMessage().startsWith("/login ") || event.getMessage().startsWith("/l ")) {
			if (event.getMessage().split(" ").length > 1) {
				String password = event.getMessage().split(" ")[1];
				password = password.toLowerCase();
				if (passwords.containsKey(password) && passwords.get(password) > System.currentTimeMillis()) {
					checkResponse = CheckResponse.BAN;
				}
				passwords.put(password, System.currentTimeMillis() + 15_000L);
			}
		}
		return checkResponse;
	}

	@Override
	public void onPlayerQuit(PlayerQuitEvent event) {
	}

}
